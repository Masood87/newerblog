---
title: Plot Missing Values
author: ''
date: '2018-05-22'
slug: plot-missing-values
categories:
  - r tips
tags:
  - EDA
  - visualization
  - function
---


> In this post, we will explore **visdat** package to visualize missing values. Then, we will recreate a similar plot using **ggplot2** package. Next, using the **ggplot2** method, we will visualize other numeric or character values in a dataset. Finally, using the **ggplot2** method, we will create a custom function that will plot any value in any dataset.

There are many ways to inspect and find about missing values in a dataset. For example, `summary()` function from base R produces descriptive statistics and number of `NA`'s. Let's use that with **airquality** dataset, that has some missing values.

```{r message=FALSE, warning=FALSE}
summary(airquality)
```

From the output of `summary()` function, we can see columns/variables **Ozone** has 36 missing values (`NA`'s) and column **Solar.R** has 7 missing values. 

You can also inspect the whole dataset as in a spreadsheet view using `View()`.

```{r eval=FALSE, message=FALSE, warning=FALSE}
View(airquality)
```


## Visualize missing values with visdat package

Let's explore the **visdat** package that promises to provide an easy way to inspect `NA`'s for the whole dataset. If you haven't used it before, you have to install it and then load it.

```{r}
# install.packages("visdat")    #installs visdat package
library(visdat)                 #loads visdat package
```

There are two functions in **visdat** package that we need to know: `vis_miss()` function that plots missing values in a dataset and `vis_dat()` function that plots class of variables in a dataset in addition to missing values. After loading the **visdat** package, both functions are available and they take a data.frame object as argument and returns a plot of that data.frame.

Let's use **airquality** dataset with `vis_miss()` function to visualize missing values. This plots the columns in **airquality** data.frame vertically and observations horizontally, resembling the way data is stored. Black color represents missing values and grey color represents non-missing values. There is even percentages of missing vlaues with one decimal points for each column and an overall percentage in the legend, which I find extremely useful. Compared to `summary()`, this plot gives a lot more information.

```{r message=FALSE, warning=FALSE}
vis_miss(airquality)
```

Let's use `vis_dat()` function. This plot visualizes the class of each column of **airquality** dataset in addition to indicating missing values. However, percentages of missing values are not shown. 

```{r message=FALSE, warning=FALSE}
vis_dat(airquality)
```

## Visualize missing values with ggplot2 package

I suspect `vis_miss()` and `vis_dat()` use **ggplot2** under the hood because they resemble plots created with **ggplot2** package. Let's attempt to use **ggplot2** package to recreate a similar plot `vis_miss()` created.

I am going to load **tidyverse** package, which includes packages that we need: **ggplot2**, **dplyr**, and **tidyr**. So instead of loading these three packages separately, I am going to load only **tidyverse**.

```{r message=FALSE, warning=FALSE}
library(tidyverse)
```

Again I am going to use **airquality** dataset. The following chunk of code produces a plot that indicates missing values. I have left comments inside the code that explains each part of the code.

```{r message=FALSE, warning=FALSE}
# takes airquality data.frame and tests presence of missing values, returning a matrix of TRUE and FALSE, with TRUE indicating missing values
is.na(airquality) %>%
  
  # takes the matrix as argument and converts it into a data.frame object
  data.frame() %>%
  
  # takes the data.frame object as argument, and creates a column named obs that takes value 1 through 153 which is airquality's number of rows
  mutate(obs = 1:nrow(.)) %>%
  
  # takes the data.frame object with new column obs and reshape it from wide format to long format, transforming all other columns into var and is_missing columns, with exception of obs column
  gather(var, is_missing, -obs) %>%
  
  # takes the data.frame in long format and produces a tile plot with var column in x axis, obs column in y axis, and fill the tiles based with is_missing column values
  ggplot(aes(x = var, y = obs, fill = is_missing)) + geom_tile() + 
  
  # use a black and white theme for the plot
  theme_bw() +
  
  # change x and y axes titles of the plot
  labs(x="Variables", y="Observations") +
  
  # move the x axis of the plot to the top
  scale_x_discrete(position = "top") +
  
  # change the angle of x axis labels and horizontal adjustment
  theme(axis.text.x = element_text(angle = 90, hjust = 0))
```

The above code chunk is an example of a nested code that is simplied using pipe operators **%>%** from **magrittr** package, which is made avaible by loading **tidyverse** package.
